# Fase III Desarrollo móvil - Modulo 3 Kotlin Avanzado
## Proyecto: aplicación para seguir progresos en el Gimnasio / de Ejercicios GYMSO

### Definición del Proyecto
***
Este proyecto está hecho para generar las pantallas de una aplicación para gestión personal de los avances en rutinas, por ejemplo, consultar ejercicios del día,
información nutrimental, noticias acerca de deportes, etc.

### Alcance del Proyecto
***
La finalidad de este proyecto es demostrar los conocimientos adquiridos durante el módulo III Kotlin Avanzado de Desarrollo Movil,
tomando la idea de un integrante del equipo y la desarrollamos basándonos en el lenguaje kotlin y a los conceptos aprendidos
durante cada sesión.

***Nota importante:*** durante el desarrollo del proyecto algunas partes del código tuvieron cambios significativos para poder
implementar temas que se vieron a lo largo del módulo.

### Integrantes:
* [Yael](https://github.com/YaelRmz)
* [Diego](https://github.com/n-DiegoTF)
* [Mario](https://github.com/marioquintalcob)
* [Erick](https://github.com/ErickDaniel04)

1.	Nombre de la aplicación: 
GYMSO
2.	Objetivo principal:
Aplicación para seguir progresos en el Gimnasio / de Ejercicios
3.	Estás dando continuidad al proyecto de kotlin intermedio o es uno nuevo:
Continuidad
4.	Brinda la liga al repositorio de tu proyecto:
https://github.com/marioquintalcob/Proyecto01Equipo16
5.	Brinda una descripción general de la aplicación:
aplicación para gestión personal de los avances en rutinas, por ejemplo, consultar ejercicios del día, información nutrimental, noticias acerca de deportes, etc.
6.	Define las funcionalidades y características de la aplicación:
La aplicación tiene como fin proporcionar al usuario un medio para que pueda registrar los avances de sus rutinas de ejercicio ya sea de forma personal o por medio del contacto de un instructor. 
Contiene una sección inicial de progresos y los ejercicios programados para el día, ejercicios favoritos y un calendario personalizado.
También cuenta con un apartado de noticias que, al estar conectado a internet, se ira actualizando con lo más relevante del deporte.
Apartado de rutinas donde el usuario podrá ver la manera correcta de realizar los ejercicios, así como los tiempos, repeticiones, instrumentos, etc. necesarios para alcanzar la meta deseada. 
También con el apartado para el manejo de perfil para personalizarlo de acuerdo con sus necesidades.

Pantalla splash:
 
![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/b89c2f3c-a2cd-4415-bf22-f1691c6d728b)

Pantalla que observa el usuario al momento de lanzar la aplicación, cuenta con el icono de esta y una barra de carga animada.

Pantalla de selección, login o registro

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/6c515a6a-2d2b-4bd5-9fe0-d9846d16e046)


En esta pantalla el usuario podrá elegir entre iniciar sesión (para usuarios ya registrados) o registrarse (usuarios nuevos)


Pantalla de login

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/be082808-6c4b-4ddc-909d-d4c1497d477e)


Pantalla para los usuarios ya registrados, en donde ingresan a la aplicación con su correo electrónico y contraseña.

Pantalla de recuperación de contraseña

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/ef5791ee-66b2-431b-94c8-50d5d0d12449)


Si el usuario olvido o perdió su contraseña, mediante su correo electrónico puede solicitar que le sea enviada.

Pantalla de registro

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/43f0fe8a-548a-4463-8c5a-71b2da9db97d)


En esta pantalla los usuarios nuevos podrán registrarse con sus datos para poder ingresar a la aplicación.

Pantalla inicial (Home)

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/d612946f-6c81-4a5e-932c-c80c87943e27)


Después de iniciar sesión el usuario visualizara esta pantalla donde se encuentra la sección de opciones, calendario, progreso y entrenamientos favoritos. En la parte de abajo se encuentra el apartado para la navegación.


Pantalla Noticias

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/fa7fd547-ce36-40ad-9b1d-f0998ecd7455)


Pantalla en donde el usuario podrá visualizar las noticias más relevantes en el mundo del deporte, de nutrición, entre otros temas de interés.

Pantalla Rutinas

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/c10a44fd-e1a1-484a-8933-54144ea5f2c8)


Pantalla en donde el usuario podrá consultar las diferentes rutinas que puede realizar, ver los detalles de repeticiones, tiempos, peso, para que regiones del cuerpo sirven, entre otra información importante para su optima realización.

Pantalla Perfil

 ![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/383e3a86-f99a-46c8-9b89-7103f8001205)

 
Pantalla en donde el usuario visualizará su información personal, así como también podrá editarla y actualizarla. Por otro lado, podrá cerrar sesión si así lo desea.

●	Wireframes 

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/cfd5d683-1ee1-4582-818b-f28fa67c6e52)
      
![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/d9ebd1da-bd93-4c65-8f53-6c543ec78f5f)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/208cf584-dee2-498c-9fc9-8d09846e5b02)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/f68d15ae-cfc5-45d9-87fd-b638fb5eacfe)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/8fc2b8be-5231-448f-8839-673820d17df9)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/37fe55ba-1c83-4a1a-aab7-19365528367c)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/8cbdbf1d-92b1-4e9a-9b26-133b598a3136)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/f0e787d9-7df1-4987-b8a6-f25551632f76)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/4e528d19-6b30-4784-b8b5-cb9584991953)
                                                                                                                                                         	                                                 
1.	**Networking:**
Firebase es una plataforma digital diseñada para facilitar el desarrollo de aplicaciones web y móviles de calidad de una forma rápida y eficiente, con el objetivo de mejorar el rendimiento de las mismas a través de la implementación de sus distintos módulos que harán que la aplicación sea mucho más manejable, segura y fácil de utilizar para los usuarios.

Cloud Firestore, la base de datos NoSQL de Firebase, flexible, escalable y en la nube con el objetivo de almacenar y sincronizar datos en tiempo real para el desarrollo en servidores, dispositivos móviles y la web. Los datos están estructurados como documentos organizados en colecciones.

Se implemento Firebase para la consulta de “Users” en el Cloud Firestore archivo UserRepository.kt:

package org.bedu.proyecto01equipo16.login.data

import android.util.Log
import com.google.firebase.auth.ktx.auth
import com.google.firebase.firestore.ktx.firestore
import com.google.firebase.ktx.Firebase
import kotlinx.coroutines.tasks.await

class UserRepository {
    private val auth = Firebase.auth
    private val db = Firebase.firestore

    suspend fun newUser(
        name: String,
        phoneNumber: String,
        email: String,
        password: String,
        profilePicture: String
    ): Boolean {
        val user = hashMapOf(
            "name" to name,
            "phoneNumber" to phoneNumber,
            "email" to email,
            //"profilePicture" to profilePicture
        )

        val existUser = db.collection("Users").document(email).get().await()
        if (existUser.data.isNullOrEmpty()) {
            auth.createUserWithEmailAndPassword(email, password)
            db.collection("Users").document(email).set(user)
            return true
        }
        return false
    }
}

2.	**Acceso a Hardware:**
Se implementa el uso de almacenamiento y la cámara del dispositivo, esto para guardar la foto del usuario al momento de registrarse. Archivo PermissionManager.kt:

package org.bedu.proyecto01equipo16.utils

import android.Manifest
import android.app.Activity
import android.content.Context
import android.content.pm.PackageManager
import androidx.core.app.ActivityCompat
import androidx.core.content.ContextCompat

class PermissionManager {

    companion object {
        const val STORAGE_PERMISSION_CODE = 100
        const val CAMERA_PERMISSION_CODE = 200
        const val CAMERA_RESULT_CODE = 201

        fun checkCameraPermission(context: Context): Boolean {
            if (ContextCompat.checkSelfPermission(context, Manifest.permission.CAMERA)
                != PackageManager.PERMISSION_GRANTED
            ) {
                return false;
            }
            return true;
        }

        fun checkStoragePermission(context: Context): Boolean {
            val write = ContextCompat.checkSelfPermission(
                context,
                Manifest.permission.WRITE_EXTERNAL_STORAGE
            )
            val read = ContextCompat.checkSelfPermission(
                context,
                Manifest.permission.READ_EXTERNAL_STORAGE
            )
            return write == PackageManager.PERMISSION_GRANTED && read == PackageManager.PERMISSION_GRANTED
        }

        fun requestStoragePermission(activity: Activity) {
            ActivityCompat.requestPermissions(
                activity,
                arrayOf(
                    Manifest.permission.WRITE_EXTERNAL_STORAGE,
                    Manifest.permission.READ_EXTERNAL_STORAGE
                ),
                STORAGE_PERMISSION_CODE
            )
        }

        fun requestCameraPermission(activity: Activity) {
            ActivityCompat.requestPermissions(
                activity, arrayOf(Manifest.permission.CAMERA),
                CAMERA_PERMISSION_CODE
            )
        }
    }
}

3.	**Persistencia y Bases de datos**

Se implementa el registro real de usuarios con Firebase, archivo RegisterViewModel.kt:

package org.bedu.proyecto01equipo16.login.signup

import android.app.Activity
import android.content.Context
import android.content.Intent
import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.launch
import org.bedu.proyecto01equipo16.login.data.UserRepository
import org.bedu.proyecto01equipo16.utils.PermissionManager

class RegisterViewModel : ViewModel() {
    private val repo = UserRepository()

    private val _emptyFields = MutableLiveData<Boolean>()
    val emptyFields: LiveData<Boolean> = _emptyFields

    private val _passwordBadFormat = MutableLiveData<Boolean>()
    val passwordBadFormat: LiveData<Boolean> = _passwordBadFormat

    private val _successfulCreated = MutableLiveData<Boolean>()
    val successfulCreated: LiveData<Boolean> = _successfulCreated

    private val _setProfilePicture = MutableLiveData<Boolean>()
    val setProfilePicture: LiveData<Boolean> = _setProfilePicture

    private val _launchCamera = MutableLiveData<Boolean>()
    val launchCamera: LiveData<Boolean> = _launchCamera

    fun validateDateAndSave(name: String, phoneNumber: String, email: String, password: String, confirmPassword: String, profilePicture: String) {
        if(name.isNotEmpty() && phoneNumber.isNotEmpty() && email.isNotEmpty() && password.isNotEmpty() && confirmPassword.isNotEmpty()) {
            if (password.length < 6 || password != confirmPassword) {
                _passwordBadFormat.value = true
                return
            }
            _passwordBadFormat.value = false
            _emptyFields.value = false
            registerUser(name, phoneNumber, email, password, profilePicture)
        } else {
            _emptyFields.value = true
            return
        }
    }

    private fun registerUser(
        name: String,
        phoneNumber: String,
        email: String,
        password: String,
        profilePicture: String
    ) {
        viewModelScope.launch {
            _successfulCreated.value = repo.newUser(name, phoneNumber, email, password, profilePicture)
        }
    }

    fun requestCamera(context: Context, activity: Activity) {
        when {
            !PermissionManager.checkStoragePermission(context) -> {
                PermissionManager.requestStoragePermission(activity)
                return
            }
            !PermissionManager.checkCameraPermission(context) -> {
                PermissionManager.requestCameraPermission(activity)
                return
            }
            else -> _launchCamera.value = true
        }
    }

    fun onRequestPermissionsResult(
        requestCode: Int, activity: Activity
    ) {
        when (requestCode) {
            PermissionManager.STORAGE_PERMISSION_CODE -> {
                PermissionManager.requestCameraPermission(activity)
                return
            }
            PermissionManager.CAMERA_PERMISSION_CODE -> {
                _launchCamera.value = true
                return
            }
        }
    }

    fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        _launchCamera.value = false
        _setProfilePicture.value = false

        if (requestCode == PermissionManager.CAMERA_RESULT_CODE) {
            _setProfilePicture.value = true
            return
        }
    }
}
 
4.	**Patrones de arquitectura:**
   
Se organizo el proyecto utilizando lo aprendido en la sesión de este tema. RegisterActivity.kt: 

package org.bedu.proyecto01equipo16.login.signup

import android.content.ContentValues
import android.content.DialogInterface
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.provider.MediaStore
import android.text.Editable
import android.text.TextWatcher
import android.util.Base64
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.lifecycle.Observer
import androidx.lifecycle.ViewModelProvider
import com.bumptech.glide.Glide
import com.bumptech.glide.load.resource.bitmap.CircleCrop
import org.bedu.proyecto01equipo16.databinding.ActivityInputBinding
import org.bedu.proyecto01equipo16.utils.PermissionManager

class RegisterActivity : AppCompatActivity() {
    private lateinit var binding: ActivityInputBinding
    private lateinit var viewModel: RegisterViewModel

    private var imageUri: Uri? = null

    private var hasBeenHandledCamera = false

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        binding = ActivityInputBinding.inflate(layoutInflater)
        setContentView(binding.root)

        viewModel = ViewModelProvider(this)[RegisterViewModel::class.java]
    }

    override fun onStart() {
        super.onStart()

        viewModel.successfulCreated.observe(this, Observer {
            val builder = AlertDialog.Builder(this)
            if (it) {
                builder
                    .setTitle("Usuario creado con exito")
                    .setMessage("Ya puedes iniciar sesion")
                    .setPositiveButton("Continuar") { dialog, _ ->
                        dialog.cancel()
                        this.finish()
                    }
                    .show()

            } else {
                builder
                    .setTitle("Hubo un problema")
                    .setMessage("Hubo un error al crear el usuario o ya existe uno registrado con ese correo")
                    .setPositiveButton("Ok", DialogInterface.OnClickListener { _, _ ->
                        finishActivity(RESULT_OK)
                    })
                    .show()
            }
        })

        viewModel.launchCamera.observe(this) {
            if (it && !hasBeenHandledCamera) {
                hasBeenHandledCamera = true
                launchCamera()
                return@observe
            }
            hasBeenHandledCamera = false
        }

        viewModel.setProfilePicture.observe(this) {
            if (it) {
                Glide.with(this)
                    .load(imageUri)
                    .transform(CircleCrop())
                    .into(binding.imaProfile)
            }
        }

        viewModel.passwordBadFormat.observe(this) {
            if (it) {
                Toast.makeText(
                    this,
                    "No coinciden las contraseñas o tiene menos de 6 caracteres",
                    Toast.LENGTH_LONG
                ).show()
            }
        }

        viewModel.emptyFields.observe(this) {
            if (it) {
                Toast.makeText(this, "Hay campos vacios", Toast.LENGTH_SHORT).show()
            }
        }

        binding.imaProfile.setOnClickListener {
            viewModel.requestCamera(this, this)
        }

        binding.btnCreateAccount.setOnClickListener {
            val bytes = imageUri?.let { it1 -> contentResolver.openInputStream(it1)?.readBytes() }
            val profilePicture = bytes?.let { Base64.encodeToString(bytes, Base64.DEFAULT) }

            viewModel.validateDateAndSave(
                name = binding.etName.text.toString(),
                phoneNumber = binding.etPhone.text.toString(),
                email = binding.etEmail.text.toString(),
                password = binding.etPassword.text.toString(),
                confirmPassword = binding.etConfirmPassword.text.toString(),
                profilePicture = profilePicture ?: ""
            )
        }

        binding.etName.addTextChangedListener(object : TextWatcher {
            override fun onTextChanged(
                s: CharSequence, start: Int,
                before: Int, count: Int
            ) {
                binding.textUserName.text = binding.etName.text
            }

            override fun afterTextChanged(p0: Editable?) {}
            override fun beforeTextChanged(p0: CharSequence?, p1: Int, p2: Int, p3: Int) {}
        })
    }

    private fun launchCamera() {
        val contentValues = ContentValues()
        contentValues.put(MediaStore.Images.Media.TITLE, "Temp_pic")
        contentValues.put(MediaStore.Images.Media.DESCRIPTION, "Temp Description")
        imageUri = this.contentResolver.insert(
            MediaStore.Images.Media.EXTERNAL_CONTENT_URI,
            contentValues
        )
        val cameraIntent = Intent(MediaStore.ACTION_IMAGE_CAPTURE)
        cameraIntent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri)
        startActivityForResult(cameraIntent, PermissionManager.CAMERA_RESULT_CODE)
    }

    override fun onRequestPermissionsResult(
        requestCode: Int,
        permissions: Array<out String>,
        grantResults: IntArray
    ) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults)
        viewModel.onRequestPermissionsResult(requestCode, this)
    }

    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)
        viewModel.onActivityResult(requestCode, resultCode, data)
    }
}

5.-**Animaciones y transiciones:**

Se implementaron transiciones al abrir nuevos activities:

startActivity(intent, ActivityOptions.makeSceneTransitionAnimation(this).toBundle())

6.-**Firebase y Notifications:**

Se configuro la aplicación para poder trabajar con Firebase Messaging:
implementation("com.google.firebase:firebase-messaging-ktx:23.1.2")

Archivo FirebaseMsgService.kt

package org.bedu.proyecto01equipo16.utils

import com.google.firebase.messaging.FirebaseMessagingService

class FirebaseMsgService: FirebaseMessagingService() {
}

La aplicación conserva todos los temas abordados en Kotlin intermedio.

La aplicación fue ideada basándose en comparación a aplicaciones de gestión de ejercicios, tomando las mejores características de estas en implementándolas a nuestro aprendizaje en desarrollo de aplicaciones, un ejemplo es la aplicación Gym WP que ofrece un periodo de prueba gratuito y posteriormente solicita una suscripción. A continuación se anexa el link a  la aplicación e imágenes. 
Gym WP - Ejercicio de Gimnasio

https://play.google.com/store/apps/details?id=com.lealApps.pedro.gymWorkoutPlan&hl=es&gl=US&pli=1

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/2d31282b-0268-40e5-8fd4-8077cf6bc3fa)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/c1475bb3-c176-4589-be3a-c36ca90f75e5)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/e6fb0aae-4f6f-4cbd-807d-df7140b0691a)
                       
![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/b9d49144-694c-47ae-9f98-98f43eca2f70)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/abdad9bb-2237-42d0-bd59-3ccbe92554e9)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/a3f731bc-3b9d-42f2-bb43-0057c1b31248)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/2a8d8ecf-fdbe-42a4-886e-1eba33885825)
                       
![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/7cdf3b4d-5163-4c8a-8888-6b2e32ea23bc)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/4b0712d0-9f90-414e-84a2-fda8d7a25a16)
                      
![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/63f088fd-d745-4e39-a4ee-fb01e1c152e1)

![imagen](https://github.com/marioquintalcob/Proyecto01Equipo16/assets/119343518/ef206873-3bb0-4ab9-a579-7661e2af813c)
